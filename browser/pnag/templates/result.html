{% extends "layout.html" %}
{% block head %}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
{% endblock %}

{% block content %}
	<article class="content-section">
		<div class="article-metadata">
			<small class="text-muted">{{ result.owner.username }}</small>
			<small class="text-muted">{{ result.date.strftime('%d.%m.%Y') }}</small>				
		</div>
		<h3 class="article-title">{{ result.custom_id }}</h3>
		{% if result.finish %}
		<button id="btn_right" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"><i class="material-icons">delete_forever</i></button>
		{% endif %}
		<p>Allowed mismatches for off targets: {{ result.mismatches }}</p>
		<p>Used genome file: <a href="{{ url_for('download', path=code | url_encode(result.genome) ) }}"><i class="material-icons">cloud_download</i></a></p>
		<p>Used target genes file: <a href="{{ url_for('download', path=code2 | url_encode(result.genes) ) }}"><i class="material-icons">cloud_download</i></a></p>
		{% if result.finish %}
			<p>ASO result file: <a href="{{ url_for('download', path=code3 | url_encode(result.result) ) }}"><i class="material-icons">cloud_download</i></a></p>
		{% endif %}
	</article>

	{% if result.finish %}
	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<h5 class="modal-title" id="exampleModalLabel">Delete Result</h5>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			  <span aria-hidden="true">&times;</span>
			</button>
		  </div>
		  <div class="modal-body">
			  <p>Are you sure you want to delete the result? This process cannot be undone.</p>
		  </div>
		  <div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="material-icons">clear</i></button>
			  <a href="{{ url_for('delete_result', result_id=result.id) }}"><button type="button" class="btn btn-primary"><i class="material-icons">check</i></button></a>
		  </div>
		</div>
	  </div>
	</div>
	<div class="content-section">
			<h3 class="border-bottom mb-4">ASOs for {{ result.custom_id }}</h3>
			<p>
				Below, the designed ASOs are visualized as they would align with the target gene's mRNA.
				If a 'GAGG' sequence was found in the mRNA, this indicates a bacterial
				Shine-Dalgarno (SD) region and additional ASOs were
				designed. 'GAGG' and start codon are highlighted by darkened fields.
				PNAs are not included if they have more than 40% self-complementarity.
			</p>
			<img src="{{ svg_res1 }}" >
		<br>
		<br>
		<br>
		<br>
			<h3 class="border-bottom mb-4"> Predicted off-targets for {{ result.custom_id }} - ASOs </h3>
					<p>The predicterd off-targets (OT) of ASOs are shown in the barplot below. OT in the whole
						transcriptome of the targeted bacterium is visualized in dar blue. OT, which are located in the
						translation initiation regions (TIR, -20 to +10 nt from start of coding sequence) of genes of
						the targeted organism. </p>
			<img src="{{ svg_res2 }}" >
		<br>
		<br>
		<br>
		<br>
			<h3 class="border-bottom mb-4"> Predicted melting temperatures for {{ result.custom_id }} - ASOs </h3>
					<p>The predicterd off-targets (OT) of ASOs are shown in the barplot below. OT in the whole
						transcriptome of the targeted bacterium is visualized in dar blue. OT, which are located in the
						translation initiation regions (TIR, -20 to +10 nt from start of coding sequence) of genes of
						the targeted organism. </p>
			<img src="{{ svg_res3 }}" class="center">
		<br>
		<br>
		<br>
		<br>
			<h3 class="border-bottom mb-4"> Summary table for {{ result.custom_id }} - ASOs </h3>
					<p> Summary for each ASO. </p>
			<img src="{{ rtable }}" class="larger">

	</div>
	{% else %}
		<p>MASON is running ... try reloading the page in about 30 seconds</p>
	{% endif %}
{% endblock %}